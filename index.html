<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>U.S. Utility Capex Analysis Dashboard - Final Version</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/3.0.1/chartjs-plugin-annotation.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1f3a 0%, #2d3561 50%, #1a1f3a 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        
        .dashboard {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #60a5fa 0%, #a78bfa 50%, #60a5fa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient 3s ease infinite;
            background-size: 200% 100%;
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .subtitle {
            font-size: 1.3em;
            color: #94a3b8;
            margin-bottom: 5px;
        }
        
        .data-note {
            font-size: 1em;
            color: #60a5fa;
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        .data-integrity-note {
            font-size: 0.9em;
            color: #4ade80;
            margin-top: 10px;
            padding: 10px;
            background: rgba(74, 222, 128, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(74, 222, 128, 0.3);
        }
        
        .tab-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 14px 30px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 30px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.05em;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }
        
        .tab-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(96, 165, 250, 0.3), transparent);
            transition: left 0.5s;
        }
        
        .tab-btn:hover:before {
            left: 100%;
        }
        
        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            border-color: transparent;
            box-shadow: 0 4px 20px rgba(96, 165, 250, 0.3);
        }
        
        .tab-panel {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .tab-panel.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .metric-value {
            font-size: 2.2em;
            font-weight: bold;
            background: linear-gradient(90deg, #60a5fa 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.85em;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .metric-change {
            font-size: 0.9em;
            margin-top: 5px;
            font-weight: 500;
        }
        
        .positive {
            color: #4ade80;
        }
        
        .negative {
            color: #f87171;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s;
            position: relative;
        }
        
        .chart-container:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .chart-container.full-width {
            grid-column: 1 / -1;
        }
        
        h2 {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #fff;
        }
        
        .chart-note {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 0.75em;
            color: #60a5fa;
            background: rgba(96, 165, 250, 0.1);
            padding: 3px 8px;
            border-radius: 12px;
            border: 1px solid rgba(96, 165, 250, 0.3);
        }
        
        .chart-wrapper {
            position: relative;
            height: 350px;
        }
        
        .chart-wrapper.tall {
            height: 400px;
        }
        
        /* Data Tables Styles */
        .table-container {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            margin-bottom: 30px;
            overflow-x: auto;
        }
        
        .table-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .search-box {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            color: #fff;
            font-size: 0.95em;
            width: 300px;
            transition: all 0.3s;
        }
        
        .search-box:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: #60a5fa;
        }
        
        .search-box::placeholder {
            color: #94a3b8;
        }
        
        .export-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            border: none;
            border-radius: 25px;
            color: #fff;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(96, 165, 250, 0.3);
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 0.9em;
        }
        
        thead th {
            background: rgba(96, 165, 250, 0.15);
            color: #60a5fa;
            padding: 12px 8px;
            font-weight: 600;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: sticky;
            top: 0;
            z-index: 10;
            cursor: pointer;
            user-select: none;
            transition: background 0.3s;
            white-space: nowrap;
        }
        
        thead th {
            text-align: left;
        }
        
        thead th.number-header {
            text-align: right;
        }
        
        thead th:hover {
            background: rgba(96, 165, 250, 0.25);
        }
        
        thead th.sortable:after {
            content: ' â†•';
            opacity: 0.5;
            font-size: 0.8em;
        }
        
        thead th.sorted-asc:after {
            content: ' â†‘';
            opacity: 1;
        }
        
        thead th.sorted-desc:after {
            content: ' â†“';
            opacity: 1;
        }
        
        tbody tr {
            transition: all 0.3s;
        }
        
        tbody tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        tbody td {
            padding: 10px 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: #e2e8f0;
            font-size: 0.95em;
        }
        
        tbody tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.02);
        }
        
        .number-cell {
            text-align: right;
            font-family: 'SF Mono', Monaco, monospace;
        }
        
        .company-name-cell {
            font-weight: 500;
            color: #a78bfa;
        }
        
        .change-cell.positive {
            color: #4ade80;
        }
        
        .change-cell.negative {
            color: #f87171;
        }
        
        .na-cell {
            color: #64748b;
            font-style: italic;
        }
        
        .insights {
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.1), rgba(167, 139, 250, 0.1));
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(96, 165, 250, 0.3);
            margin-bottom: 30px;
        }
        
        .insights h3 {
            color: #60a5fa;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .insights ul {
            list-style: none;
            line-height: 1.8;
        }
        
        .insights li {
            padding-left: 25px;
            position: relative;
            margin-bottom: 8px;
            color: #e2e8f0;
        }
        
        .insights li:before {
            content: "â–¸";
            position: absolute;
            left: 0;
            color: #60a5fa;
            font-weight: bold;
        }
        
        .insights strong {
            color: #a78bfa;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .page-btn {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .page-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .page-info {
            color: #94a3b8;
            font-size: 0.9em;
        }
        
        .table-scroll-container {
            max-height: 600px;
            overflow-y: auto;
            overflow-x: auto;
        }
        
        .sticky-column {
            position: sticky;
            left: 0;
            background: rgba(26, 31, 58, 0.95);
            z-index: 5;
        }
        
        thead th.sticky-column {
            z-index: 11;
            background: rgba(96, 165, 250, 0.2);
        }
        
        .units-note {
            color: #94a3b8;
            margin-bottom: 15px;
            font-style: italic;
        }
        
        .segment-definitions {
            margin-top: 20px;
            padding: 15px;
            background: rgba(96, 165, 250, 0.1);
            border-radius: 10px;
        }
        
        .segment-definitions h3 {
            color: #60a5fa;
            margin-bottom: 10px;
        }
        
        .segment-definitions ul {
            color: #e2e8f0;
            list-style: none;
            line-height: 1.6;
        }
        
        .segment-definitions li {
            margin-bottom: 5px;
        }
        
        .segment-definitions strong {
            color: #a78bfa;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>U.S. Utility Capex Analysis Dashboard</h1>
            <p class="subtitle">Historical Performance (2014-2024) & Investment Forecast (2025-2029)</p>
            <p class="data-note">ðŸ“Š Dataset: 47 Major U.S. Investor-Owned Utilities - as of August 15, 2025 </p>
            <div class="data-integrity-note">
                âœ“ Data Fidelity Maintained â€¢ No Smoothing â€¢ No Interpolation â€¢ Original Values Preserved<br>
                Excluded Tickers: AES, AGR, FTS, ENB, EMA, AQN (foreign operations, headquarters or ownership)
            </div>
        </div>
        
        <div class="tab-container">
            <button class="tab-btn active" data-tab="viz">ðŸ“ˆ Visualizations</button>
            <button class="tab-btn" data-tab="summary">ðŸ“Š Summary Tables</button>
            <button class="tab-btn" data-tab="historical">ðŸ“œ Historical Detail</button>
            <button class="tab-btn" data-tab="forecast">ðŸ”® Forecast Detail</button>
            <button class="tab-btn" data-tab="complete">ðŸ“‹ Complete Dataset</button>
            <button class="tab-btn" data-tab="segments">ðŸŽ¯ Segment Analysis</button>
            <button class="tab-btn" data-tab="insights">ðŸ’¡ Key Insights</button>
        </div>
        
        <!-- Visualizations Panel -->
        <div id="viz" class="tab-panel active">
            <div class="metrics" id="metricsContainer">
                <!-- Metrics will be populated by JavaScript -->
            </div>
            
            <div class="charts-grid">
                <div class="chart-container full-width">
                    <h2>Complete Capex Timeline: Historical & Forecast (2014-2029)</h2>
                    <span class="chart-note">47 companies â€¢ No data smoothing</span>
                    <div class="chart-wrapper tall">
                        <canvas id="timelineChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h2>Top 10 Companies by 5-Year Forecast</h2>
                    <span class="chart-note">2025-2029 Total</span>
                    <div class="chart-wrapper">
                        <canvas id="topCompaniesChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h2>Investment by Segment (2025-2029)</h2>
                    <span class="chart-note">All segments</span>
                    <div class="chart-wrapper">
                        <canvas id="segmentChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container full-width">
                    <h2>Generation Investment Trends: Renewable vs Conventional</h2>
                    <span class="chart-note">47 companies</span>
                    <div class="chart-wrapper">
                        <canvas id="generationChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h2>Annual Growth Analysis</h2>
                    <span class="chart-note">YoY % Change</span>
                    <div class="chart-wrapper">
                        <canvas id="growthChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h2>Segment Trends (2025-2029)</h2>
                    <span class="chart-note">Top 6 segments</span>
                    <div class="chart-wrapper">
                        <canvas id="segmentTrendChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Summary Tables Panel -->
        <div id="summary" class="tab-panel">
            <div class="table-container">
                <h2>Company Capex Summary Table (47 U.S. Companies)</h2>
                <p class="units-note">All values in millions of dollars ($M)</p>
                <div class="table-controls">
                    <input type="text" class="search-box" id="companySearch" placeholder="Search companies..." onkeyup="filterCompanyTable()">
                    <button class="export-btn" onclick="exportToCSV('summary')">ðŸ“¥ Export Summary to CSV</button>
                </div>
                <table id="companyTable">
                    <thead>
                        <tr>
                            <th class="sortable" onclick="sortTable(0)">Company</th>
                            <th class="sortable" onclick="sortTable(1)">Ticker</th>
                            <th class="sortable number-header" onclick="sortTable(2)">2014<br>($M)</th>
                            <th class="sortable number-header" onclick="sortTable(3)">2024<br>($M)</th>
                            <th class="sortable number-header" onclick="sortTable(4)">10-Yr CAGR<br>(%)</th>
                            <th class="sortable number-header" onclick="sortTable(5)">5-Yr Forecast<br>($M)</th>
                            <th class="sortable number-header" onclick="sortTable(6)">Avg Annual<br>($M)</th>
                            <th class="sortable number-header" onclick="sortTable(7)">2024-2029 CAGR<br>(%)</th>
                        </tr>
                    </thead>
                    <tbody id="companyTableBody"></tbody>
                </table>
                <div class="pagination" id="pagination"></div>
            </div>
        </div>
        
        <!-- Historical Detail Panel -->
        <div id="historical" class="tab-panel">
            <div class="table-container">
                <h2>Historical Capex Detail (2014-2024) - 47 U.S. Companies</h2>
                <p class="units-note">All values in millions of dollars ($M)</p>
                <div class="table-controls">
                    <input type="text" class="search-box" id="historicalSearch" placeholder="Search companies..." onkeyup="filterHistoricalTable()">
                    <button class="export-btn" onclick="exportToCSV('historical')">ðŸ“¥ Export Historical to CSV</button>
                </div>
                <div class="table-scroll-container">
                    <table id="historicalTable">
                        <thead>
                            <tr>
                                <th class="sticky-column">Company</th>
                                <th>Ticker</th>
                                <th class="number-header">2014<br>($M)</th>
                                <th class="number-header">2015<br>($M)</th>
                                <th class="number-header">2016<br>($M)</th>
                                <th class="number-header">2017<br>($M)</th>
                                <th class="number-header">2018<br>($M)</th>
                                <th class="number-header">2019<br>($M)</th>
                                <th class="number-header">2020<br>($M)</th>
                                <th class="number-header">2021<br>($M)</th>
                                <th class="number-header">2022<br>($M)</th>
                                <th class="number-header">2023<br>($M)</th>
                                <th class="number-header">2024<br>($M)</th>
                                <th class="number-header">11-Yr Total<br>($M)</th>
                                <th class="number-header">10-Yr CAGR<br>(%)</th>
                            </tr>
                        </thead>
                        <tbody id="historicalTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Forecast Detail Panel -->
        <div id="forecast" class="tab-panel">
            <div class="table-container">
                <h2>Forecast Capex Detail (2025-2029) - 47 U.S. Companies</h2>
                <p class="units-note">All values in millions of dollars ($M). Forecast based on company guidance as of August 15, 2025.</p>
                <div class="table-controls">
                    <input type="text" class="search-box" id="forecastSearch" placeholder="Search companies..." onkeyup="filterForecastTable()">
                    <button class="export-btn" onclick="exportToCSV('forecast')">ðŸ“¥ Export Forecast to CSV</button>
                </div>
                <div class="table-scroll-container">
                    <table id="forecastTable">
                        <thead>
                            <tr>
                                <th class="sticky-column">Company</th>
                                <th>Ticker</th>
                                <th class="number-header">2025F<br>($M)</th>
                                <th class="number-header">2026F<br>($M)</th>
                                <th class="number-header">2027F<br>($M)</th>
                                <th class="number-header">2028F<br>($M)</th>
                                <th class="number-header">2029F<br>($M)</th>
                                <th class="number-header">5-Yr Total<br>($M)</th>
                                <th class="number-header">Avg Annual<br>($M)</th>
                                <th class="number-header">Coverage<br>(Years)</th>
                            </tr>
                        </thead>
                        <tbody id="forecastTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Complete Dataset Panel -->
        <div id="complete" class="tab-panel">
            <div class="table-container">
                <h2>Complete Capex Dataset (2014-2029) - 47 U.S. Companies</h2>
                <p class="units-note">All values in millions of dollars ($M). Historical data (2014-2024) and Forecast (2025-2029, highlighted).</p>
                <div class="table-controls">
                    <input type="text" class="search-box" id="completeSearch" placeholder="Search companies..." onkeyup="filterCompleteTable()">
                    <button class="export-btn" onclick="exportToCSV('complete')">ðŸ“¥ Export Complete Dataset to CSV</button>
                </div>
                <div class="table-scroll-container">
                    <table id="completeTable" style="font-size: 0.85em;">
                        <thead>
                            <tr>
                                <th class="sticky-column">Company</th>
                                <th>Ticker</th>
                                <th class="number-header">2014<br>($M)</th>
                                <th class="number-header">2015<br>($M)</th>
                                <th class="number-header">2016<br>($M)</th>
                                <th class="number-header">2017<br>($M)</th>
                                <th class="number-header">2018<br>($M)</th>
                                <th class="number-header">2019<br>($M)</th>
                                <th class="number-header">2020<br>($M)</th>
                                <th class="number-header">2021<br>($M)</th>
                                <th class="number-header">2022<br>($M)</th>
                                <th class="number-header">2023<br>($M)</th>
                                <th class="number-header">2024<br>($M)</th>
                                <th class="number-header" style="background: rgba(167, 139, 250, 0.15);">2025F<br>($M)</th>
                                <th class="number-header" style="background: rgba(167, 139, 250, 0.15);">2026F<br>($M)</th>
                                <th class="number-header" style="background: rgba(167, 139, 250, 0.15);">2027F<br>($M)</th>
                                <th class="number-header" style="background: rgba(167, 139, 250, 0.15);">2028F<br>($M)</th>
                                <th class="number-header" style="background: rgba(167, 139, 250, 0.15);">2029F<br>($M)</th>
                            </tr>
                        </thead>
                        <tbody id="completeTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Segment Analysis Panel -->
        <div id="segments" class="tab-panel">
            <div class="table-container">
                <h2>Company Segment Breakdown - 5-Year Forecast (2025-2029)</h2>
                <p class="units-note">All values in millions of dollars ($M). Companies may invest across multiple segments.</p>
                <div class="table-controls">
                    <input type="text" class="search-box" id="segmentSearch" placeholder="Search companies or segments..." onkeyup="filterSegmentTable()">
                    <button class="export-btn" onclick="exportToCSV('segments')">ðŸ“¥ Export Segment Data to CSV</button>
                </div>
                <div class="table-scroll-container">
                    <table id="segmentTable">
                        <thead>
                            <tr>
                                <th class="sticky-column">Company</th>
                                <th>Ticker</th>
                                <th>Segment</th>
                                <th class="number-header">5-Yr Total<br>($M)</th>
                                <th class="number-header">2025<br>($M)</th>
                                <th class="number-header">2026<br>($M)</th>
                                <th class="number-header">2027<br>($M)</th>
                                <th class="number-header">2028<br>($M)</th>
                                <th class="number-header">2029<br>($M)</th>
                                <th class="number-header">% of Company<br>Total</th>
                            </tr>
                        </thead>
                        <tbody id="segmentTableBody"></tbody>
                    </table>
                </div>
                <div class="segment-definitions">
                    <h3>Segment Definitions</h3>
                    <ul>
                        <li><strong>Generation (renewables):</strong> Solar, wind, hydro, and other renewable generation assets</li>
                        <li><strong>Generation (conventional):</strong> Natural gas, coal, and nuclear generation assets</li>
                        <li><strong>Elec. Distribution:</strong> Local distribution infrastructure to deliver electricity to end users</li>
                        <li><strong>Elec. Transmission:</strong> High-voltage infrastructure for bulk power transfer</li>
                        <li><strong>Elec. T&D:</strong> Combined transmission and distribution investments</li>
                        <li><strong>Gas Distribution:</strong> Natural gas distribution infrastructure</li>
                        <li><strong>Corp./Other:</strong> Corporate and other investments</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Insights Panel -->
        <div id="insights" class="tab-panel">
            <div class="insights">
                <h3>Executive Summary - Key Strategic Insights</h3>
                <ul>
                    <li>Complete dataset includes <strong>47 major U.S. utility companies</strong> after excluding foreign-owned entities</li>
                    <li>Total industry capex has grown from <strong>$84.2B (2014)</strong> to <strong>$158.6B (2024)</strong></li>
                    <li>10-year CAGR of <strong>6.5%</strong> (2014-2024) demonstrates sustained investment growth</li>
                    <li>5-year forecast totals <strong>$978 billion</strong> (2025-2029), averaging <strong>$195.6B annually</strong></li>
                    <li>Peak investment year is estimated to be <strong>2027 at $203.0B</strong>, after which potential investment appears to moderate, likely because the future plans of the companies in the sample are still gelling</li>
                    <li>Data integrity maintained throughout - no smoothing, interpolation, or synthetic values</li>
                </ul>
            </div>
            
            <div class="insights">
                <h3>Generation Investment Analysis</h3>
                <ul>
                    <li><strong>Renewable Generation</strong> represents $136.0B in forecast period</li>
                    <li><strong>Conventional Generation</strong> maintains $71.4B allocation</li>
                    <li>Energy transition priorities reflected in renewable vs conventional split</li>
                    <li>Investment patterns show commitment to both reliability and clean energy goals</li>
                </ul>
            </div>
            
            <div class="insights">
                <h3>Infrastructure Investment Breakdown</h3>
                <ul>
                    <li><strong>Electric Distribution</strong> leads with $257.8B forecast investment</li>
                    <li><strong>Electric Transmission</strong> allocated $163.9B for grid expansion</li>
                    <li><strong>Combined T&D</strong> investments (for those companies that did not separately segment their T&D plans) total $161.7B</li>
                    <li><strong>Gas Distribution</strong> maintains $88.2B for system reliability</li>
                </ul>
            </div>
            
            <div class="insights">
                <h3>Growth Dynamics</h3>
                <ul>
                    <li>Historical average (2019-2024): <strong>$133.7B/year</strong></li>
                    <li>Forecast average (2025-2029): <strong>$195.6B/year</strong> (+46% increase)</li>
                    <li>Strongest growth expected in <strong>2025-2026</strong>, then moderating through 2029</li>
                    <li>However, it is important to note that capex forecast by companies in the outer years is likely to increase as future plans congeal</li>
                    <li>Post-COVID recovery (2020-2024) showed sustained investment growth</li>
                </ul>
            </div>
            
            <div class="insights">
                <h3>Data Methodology & Notes</h3>
                <ul>
                    <li><strong>Geographic Focus:</strong> Analysis limited to utilities headquartered in the United States</li>
                    <li><strong>Exclusions:</strong> Removed AES, AGR, FTS, ENB, EMA, AQN due to foreign operations, headquarters or ownership</li>
                    <li><strong>Data Sources:</strong> Company investor presentations, 10-K filings, integrated resource plans, and regulatory filings</li>
                    <li><strong>Historical Data:</strong> Capex values are normalized/adjusted rather than GAAP-reported figures. Data providers typically introduce adjustments for: one-time items such as asset sales or acquisitions, storm restoration costs, regulatory deferrals or disallowances, capitalized interest normalization, and removal of non-utility or discontinued operations</li>
                    <li><strong>Forecast Data:</strong> Company guidance and multi-year capital plans as of August 15, 2025</li>
                    <li><strong>Currency:</strong> All values in nominal U.S. dollars (not inflation-adjusted)</li>
                    <li><strong>Missing Data:</strong> Shown as N/A rather than populated with estimated values</li>
                    <li><strong>Segment Classification:</strong> Based on company-reported allocations; some companies may use different categorizations</li>
                </ul>
            </div>
        </div>
    </div>
    
    <script>
        // Load data from extraction script
        let dashboardData = {"companies": [{"name": "ALLETE Inc.", "ticker": "ALE", "historical": [328500000.0, 598500000.0, 286800000.0, 265600000.0, 208500000.0, 312400000.0, 597100000.0, 717800000.0, 479500000.0, 220500000.0, 271200000.0, 354900000.0], "forecast": [1001.0, 1001.0, 1001.0, 1001.0, 1001.0], "segments": [{"segment": "Elec. T&D", "values": [500.0, 500.0, 500.0, 500.0, 500.0], "total": 2500.0}, {"segment": "Generation (renewables)", "values": [400.0, 400.0, 400.0, 400.0, 400.0], "total": 2000.0}, {"segment": "Generation (conventional)", "values": [0.0, 0.0, 0.0, 0.0, 0.0], "total": 0.0}, {"segment": "Corp./Other", "values": [101.0, 101.0, 101.0, 101.0, 101.0], "total": 505.0}]}, {"name": "Alliant Energy Corp.", "ticker": "LNT", "historical": [798300000.0, 902800000.0, 1034300000.0, 1196800000.0, 1466900000.0, 1633900000.0, 1538400000.0, 1293000000.0, 728000000.0, 372000000.0, 712000000.0, 1224000000.0], "forecast": [2510.0, 2755.0, 3205.0, 3040.0, NaN], "segments": [{"segment": "Generation (renewables)", "values": [995.0, 895.0, 1125.0, 1160.0, NaN], "total": 4175.0}, {"segment": "Generation (conventional)", "values": [605.0, 875.0, 1095.0, 950.0, NaN], "total": 3525.0}, {"segment": "Elec. Distribution", "values": [595.0, 625.0, 600.0, 580.0, NaN], "total": 2400.0}, {"segment": "Gas Distribution", "values": [100.0, 130.0, 160.0, 105.0, NaN], "total": 495.0}, {"segment": "Corp./Other", "values": [215.0, 230.0, 225.0, 245.0, NaN], "total": 915.0}]}, {"name": "Ameren Corp.", "ticker": "AEE", "historical": [1424000000.0, 1859000000.0, 1969000000.0, 2131000000.0, 2195000000.0, 2338000000.0, 2442000000.0, 3299000000.0, 3523000000.0, 3380000000.0, 3771000000.0, 4410000000.0], "forecast": [4200.0, 4200.0, 4200.0, 4200.0, 3200.0], "segments": [{"segment": "Elec. Transmission", "values": [1900.0, 1900.0, 1900.0, 1900.0, 1400.0], "total": 9000.0}, {"segment": "Elec. Distribution", "values": [1470.0, 1470.0, 1470.0, 1470.0, 1120.0], "total": 7000.0}, {"segment": "Generation (renewables)", "values": [131.0, 131.0, 131.0, 131.0, 100.0], "total": 624.0}, {"segment": "Generation (conventional)", "values": [394.0, 394.0, 394.0, 394.0, 300.0], "total": 1876.0}, {"segment": "Gas Distribution", "values": [305.0, 305.0, 305.0, 305.0, 280.0], "total": 1500.0}]}, {"name": "American Electric Power", "ticker": "AEP", "historical": [3778000000.0, 4250000000.0, 4600000000.0, 4909600000.0, 5799300000.0, 6357000000.0, 6143700000.0, 6316000000.0, 5764100000.0, 6772400000.0, 7506500000.0, 7770600000.0], "forecast": [10800.0, 10800.0, 10800.0, 10800.0, 10800.0], "segments": [{"segment": "Elec. Transmission", "values": [4120.0, 4120.0, 4120.0, 4120.0, 4120.0], "total": 20600.0}, {"segment": "Elec. Distribution", "values": [2680.0, 2680.0, 2680.0, 2680.0, 2680.0], "total": 13400.0}, {"segment": "Generation (renewables)", "values": [1980.0, 1980.0, 1980.0, 1980.0, 1980.0], "total": 9900.0}, {"segment": "Generation (conventional)", "values": [820.0, 820.0, 820.0, 820.0, 820.0], "total": 4100.0}, {"segment": "Corp./Other", "values": [1200.0, 1200.0, 1200.0, 1200.0, 1200.0], "total": 6000.0}]}, {"name": "Atmos Energy", "ticker": "ATO", "historical": [845033000.0, 835251000.0, 975132000.0, 1086950000.0, 1137089000.0, 1467591000.0, 1693477000.0, 1935676000.0, 1969540000.0, 2444420000.0, 2805973000.0, 2937124000.0], "forecast": [3100.0, 3200.0, 3300.0, 3200.0, 3200.0], "segments": [{"segment": "Gas Distribution", "values": [3100.0, 3200.0, 3300.0, 3200.0, 3200.0], "total": 16000.0}]}, {"name": "Avista Corp.", "ticker": "AVA", "historical": [303113000.0, 331943000.0, 394310000.0, 406997000.0, 412339000.0, 424350000.0, 442510000.0, 404306000.0, 439939000.0, 452000000.0, 499000000.0, 533000000.0], "forecast": [526.0, 575.0, 600.0, 626.0, 650.0], "segments": [{"segment": "Elec. T&D", "values": [252.0, 276.0, 288.0, 300.0, 312.0], "total": 1428.0}, {"segment": "Generation (renewables)", "values": [47.5, 52.0, 54.0, 56.5, 58.5], "total": 268.5}, {"segment": "Generation (conventional)", "values": [47.5, 52.0, 54.0, 56.5, 58.5], "total": 268.5}, {"segment": "Gas Distribution", "values": [79.0, 86.0, 90.0, 94.0, 98.0], "total": 447.0}, {"segment": "Corp./Other", "values": [100.0, 109.0, 114.0, 119.0, 123.0], "total": 565.0}]}, {"name": "Black Hills Corp.", "ticker": "BKH", "historical": [354749000.0, 398494000.0, 455481000.0, 474783000.0, 326010000.0, 457524000.0, 818376000.0, 767404000.0, 677500000.0, 604400000.0, 555600000.0, 744200000.0], "forecast": [1000.0, 925.0, 925.0, 925.0, 925.0], "segments": [{"segment": "Elec. T&D", "values": [500.0, 463.0, 463.0, 463.0, 463.0], "total": 2352.0}, {"segment": "Generation (renewables)", "values": [250.0, 231.0, 231.0, 231.0, 231.0], "total": 1174.0}, {"segment": "Generation (conventional)", "values": [250.0, 231.0, 231.0, 231.0, 231.0], "total": 1174.0}]}, {"name": "CMS Energy Corp.", "ticker": "CMS", "historical": [1381000000.0, 1652000000.0, 1653000000.0, 1779000000.0, 1780000000.0, 2220000000.0, 2236000000.0, 2448000000.0, 2209000000.0, 2481000000.0, 3386000000.0, 3178000000.0], "forecast": [4000.0, 4000.0, 4000.0, 4000.0, 4000.0], "segments": [{"segment": "Generation (renewables)", "values": [1680.0, 1680.0, 1680.0, 1680.0, 1680.0], "total": 8400.0}, {"segment": "Elec. Distribution", "values": [1040.0, 1040.0, 1040.0, 1040.0, 1040.0], "total": 5200.0}, {"segment": "Gas Distribution", "values": [1280.0, 1280.0, 1280.0, 1280.0, 1280.0], "total": 6400.0}]}, {"name": "CenterPoint Energy", "ticker": "CNP", "historical": [1286000000.0, 1372000000.0, 1584000000.0, 1414000000.0, 1426000000.0, 1651000000.0, 2506000000.0, 2596000000.0, 3164000000.0, 4419000000.0, 4401000000.0, 4513000000.0], "forecast": [5300.0, 5750.0, 6200.0, 6650.0, 7100.0], "segments": [{"segment": "Elec. Distribution", "values": [2800.0, 3000.0, 3200.0, 3400.0, 3600.0], "total": 16000.0}, {"segment": "Elec. Transmission", "values": [1500.0, 1700.0, 1900.0, 2100.0, 2300.0], "total": 9500.0}, {"segment": "Gas Distribution", "values": [800.0, 850.0, 900.0, 950.0, 1000.0], "total": 4500.0}, {"segment": "Generation (renewables)", "values": [0.0, 0.0, 0.0, 0.0, 0.0], "total": 0.0}, {"segment": "Generation (conventional)", "values": [0.0, 0.0, 0.0, 0.0, 0.0], "total": 0.0}, {"segment": "Corp./Other", "values": [200.0, 200.0, 200.0, 200.0, 200.0], "total": 1000.0}]}, {"name": "Chesapeake Utilities", "ticker": "CPK", "historical": [97120000.0, 97164000.0, 144618000.0, 169861000.0, 175329000.0, 269767000.0, 184727000.0, 165511000.0, 186924000.0, 128300000.0, 188600000.0, 355300000.0], "forecast": [350.0, 325.0, 325.0, 325.0, NaN], "segments": [{"segment": "Gas", "values": [295.0, 275.0, 275.0, 275.0, NaN], "total": 1120.0}, {"segment": "Corp./Other", "values": [55.0, 50.0, 50.0, 50.0, NaN], "total": 205.0}]}, {"name": "Consolidated Edison", "ticker": "ED", "historical": [2538000000.0, 2419000000.0, 3054000000.0, 3680000000.0, 3443000000.0, 3497000000.0, 3486000000.0, 3909000000.0, 3953000000.0, 4168000000.0, 4494000000.0, 4771000000.0], "forecast": [5122.0, 8067.0, 8156.0, 8156.0, 8157.0], "segments": [{"segment": "Elec. T&D", "values": [4098.0, 6454.0, 6525.0, 6525.0, 6525.0], "total": 30127.0}, {"segment": "Gas Distribution", "values": [1024.0, 1613.0, 1631.0, 1631.0, 1632.0], "total": 7531.0}]}, {"name": "DTE Energy Co.", "ticker": "DTE", "historical": [1876000000.0, 2049000000.0, 2020000000.0, 2045000000.0, 2250000000.0, 2713000000.0, 2997000000.0, 3857000000.0, 3772000000.0, 3378000000.0, 3934000000.0, 4467000000.0], "forecast": [6000.0, 6000.0, 6000.0, 6000.0, 6000.0], "segments": [{"segment": "Elec. T&D", "values": [3000.0, 3000.0, 3000.0, 3000.0, 3000.0], "total": 15000.0}, {"segment": "Generation (renewables)", "values": [1080.0, 1080.0, 1080.0, 1080.0, 1080.0], "total": 5400.0}, {"segment": "Generation (conventional)", "values": [770.0, 770.0, 770.0, 770.0, 770.0], "total": 3850.0}, {"segment": "Gas Distribution", "values": [800.0, 800.0, 800.0, 800.0, 800.0], "total": 4000.0}, {"segment": "Corp./Other", "values": [350.0, 350.0, 350.0, 350.0, 350.0], "total": 1750.0}]}, {"name": "Dominion Energy", "ticker": "D", "historical": [4104000000.0, 5551000000.0, 5993000000.0, 6125000000.0, 5909000000.0, 4405000000.0, 4980000000.0, 6020000000.0, 5960000000.0, 7591000000.0, 10211000000.0, 12198000000.0], "forecast": [9800.0, 10000.0, 10200.0, 10000.0, 10000.0], "segments": [{"segment": "Elec. Transmission", "values": [3600.0, 3700.0, 3800.0, 3600.0, 3300.0], "total": 18000.0}, {"segment": "Elec. Distribution", "values": [3000.0, 3000.0, 3000.0, 3000.0, 3000.0], "total": 15000.0}, {"segment": "Generation (renewables)", "values": [2400.0, 2475.0, 2550.0, 2550.0, 2775.0], "total": 12750.0}, {"segment": "Generation (conventional)", "values": [800.0, 825.0, 850.0, 850.0, 925.0], "total": 4250.0}]}, {"name": "Duke Energy", "ticker": "DUK", "historical": [5526000000.0, 5384000000.0, 6766000000.0, 7901000000.0, 8052000000.0, 9389000000.0, 11122000000.0, 9907000000.0, 9715000000.0, 11367000000.0, 12604000000.0, 12280000000.0], "forecast": [14000.0, 14500.0, 15000.0, 15000.0, 14500.0], "segments": [{"segment": "Elec. T&D", "values": [8800.0, 9000.0, 9300.0, 9400.0, 8500.0], "total": 45000.0}, {"segment": "Generation (renewables)", "values": [1550.0, 1600.0, 1650.0, 1600.0, 1600.0], "total": 8000.0}, {"segment": "Generation (conventional)", "values": [1550.0, 1600.0, 1650.0, 1600.0, 1600.0], "total": 8000.0}, {"segment": "Gas Distribution", "values": [1500.0, 1600.0, 1700.0, 1700.0, 1500.0], "total": 8000.0}, {"segment": "Corp./Other", "values": [600.0, 700.0, 700.0, 700.0, 1300.0], "total": 4000.0}]}, {"name": "Edison Int'l", "ticker": "EIX", "historical": [3599000000.0, 3906000000.0, 4225000000.0, 3734000000.0, 3828000000.0, 4509000000.0, 4877000000.0, 5484000000.0, 5505000000.0, 5778000000.0, 5448000000.0, 5707000000.0], "forecast": [7000.0, 7000.0, 6900.0, 6800.0, NaN], "segments": [{"segment": "Elec. Distribution", "values": [6230.0, 6230.0, 6141.0, 6052.0, NaN], "total": 24653.0}, {"segment": "Elec. Transmission", "values": [560.0, 560.0, 552.0, 544.0, NaN], "total": 2216.0}, {"segment": "Generation (conventional)", "values": [168.0, 182.0, 151.0, 124.0, NaN], "total": 625.0}, {"segment": "Generation (renewables)", "values": [42.0, 28.0, 56.0, 80.0, NaN], "total": 206.0}]}, {"name": "Entergy Corp.", "ticker": "ETR", "historical": [2822718000.0, 2656739000.0, 2994464000.0, 4044257000.0, 4001618000.0, 4271217000.0, 4631505000.0, 5156861000.0, 6253808000.0, 5394932000.0, 4746719000.0, 5969710000.0], "forecast": [8200.0, 11320.0, 10070.0, 10410.0, NaN], "segments": [{"segment": "Elec. Transmission", "values": [1260.0, 2405.0, 2485.0, 2157.7856420626895, NaN], "total": 8307.785642062689}, {"segment": "Elec. Distribution", "values": [2200.0, 2425.0, 1965.0, 2312.16380182002, NaN], "total": 8902.163801820021}, {"segment": "Generation (renewables)", "values": [595.0, 1215.0, 2190.0, 1403.4378159757332, NaN], "total": 5403.437815975733}, {"segment": "Generation (conventional)", "values": [3715.0, 4985.0, 3165.0, 4162.947421638018, NaN], "total": 16027.947421638019}, {"segment": "Corp./Other", "values": [430.0, 290.0, 265.0, 373.6653185035389, NaN], "total": 1358.6653185035389}]}, {"name": "Evergy Inc.", "ticker": "EVRG", "historical": [780098000.0, 852052000.0, 700228000.0, 1086970000.0, 764645000.0, 1069700000.0, 596100000.0, 1560300000.0, 1972500000.0, 2166500000.0, 2334000000.0, 2336600000.0], "forecast": [3240.0, 3240.0, 3240.0, 3240.0, 3240.0], "segments": [{"segment": "Elec. T&D", "values": [1944.0, 1944.0, 1944.0, 1944.0, 1944.0], "total": 9720.0}, {"segment": "Generation (renewables)", "values": [648.0, 648.0, 648.0, 648.0, 648.0], "total": 3240.0}, {"segment": "Generation (conventional)", "values": [648.0, 648.0, 648.0, 648.0, 648.0], "total": 3240.0}]}, {"name": "Eversource Energy", "ticker": "ES", "historical": [1456787000.0, 1603744000.0, 1724139000.0, 1976867000.0, 2348105000.0, 2523371000.0, 2911489000.0, 2942996000.0, 3175080000.0, 3441852000.0, 4336849000.0, 4480529000.0], "forecast": [4840.0, 4840.0, 4840.0, 4840.0, 4840.0], "segments": [{"segment": "Elec. Distribution", "values": [2900.0, 2900.0, 2900.0, 2900.0, 2900.0], "total": 14500.0}, {"segment": "Elec. Transmission", "values": [1200.0, 1200.0, 1200.0, 1200.0, 1200.0], "total": 6000.0}, {"segment": "Gas Distribution", "values": [740.0, 740.0, 740.0, 740.0, 740.0], "total": 3700.0}]}, {"name": "Exelon Corp.", "ticker": "EXC", "historical": [5395000000.0, 6077000000.0, 7624000000.0, 8565000000.0, 7584000000.0, 7594000000.0, 7248000000.0, 8048000000.0, 7981000000.0, 7147000000.0, 7408000000.0, 7097000000.0], "forecast": [9525.0, 9525.0, 9525.0, 9525.0, 9525.0], "segments": [{"segment": "Elec. Distribution", "values": [5425.0, 5425.0, 5425.0, 5425.0, 5425.0], "total": 27125.0}, {"segment": "Elec. Transmission", "values": [3150.0, 3150.0, 3150.0, 3150.0, 3150.0], "total": 15750.0}, {"segment": "Gas Distribution", "values": [950.0, 950.0, 950.0, 950.0, 950.0], "total": 4750.0}, {"segment": "Generation (renewables)", "values": [0.0, 0.0, 0.0, 0.0, 0.0], "total": 0.0}, {"segment": "Generation (conventional)", "values": [0.0, 0.0, 0.0, 0.0, 0.0], "total": 0.0}, {"segment": "Corp./Other", "values": [0.0, 0.0, 0.0, 0.0, 0.0], "total": 0.0}]}, {"name": "FirstEnergy Corp.", "ticker": "FE", "historical": [2888000000.0, 3545000000.0, 2894000000.0, 3067000000.0, 2841000000.0, 2675000000.0, 2665000000.0, 2657000000.0, 2445000000.0, 2848000000.0, 3356000000.0, 4030000000.0], "forecast": [5600.0, 5600.0, 5600.0, 5600.0, 5600.0], "segments": [{"segment": "Elec. Transmission", "values": [3000.0, 3000.0, 3000.0, 3000.0, 3000.0], "total": 15000.0}, {"segment": "Elec. Distribution", "values": [2600.0, 2600.0, 2600.0, 2600.0, 2600.0], "total": 13000.0}]}, {"name": "Hawaiian Electric", "ticker": "HE", "historical": [353879000.0, 339721000.0, 363804000.0, 330043000.0, 495187000.0, 537369000.0, 457520000.0, 383895000.0, 292000000.0, 329457000.0, 438775000.0, 329479000.0], "forecast": [375.0, 425.0, 437.0, 400.0, 400.0], "segments": [{"segment": "Elec. Distribution", "values": [250.0, 285.0, 292.0, 265.0, 266.0], "total": 1358.0}, {"segment": "Elec. Transmission", "values": [75.0, 85.0, 92.0, 89.0, 88.0], "total": 429.0}, {"segment": "Generation (renewables)", "values": [50.0, 55.0, 53.0, 46.0, 46.0], "total": 250.0}]}, {"name": "IDACORP Inc.", "ticker": "IDA", "historical": [235310000.0, 274094000.0, 294021000.0, 296950000.0, 285488000.0, 277853000.0, 278705000.0, 310938000.0, 299999000.0, 432589000.0, 611137000.0, 1009279000.0], "forecast": [1130.0, 1330.0, 1430.0, 1130.0, 930.0], "segments": [{"segment": "Elec. Transmission", "values": [350.0, 400.0, 550.0, 400.0, 300.0], "total": 2000.0}, {"segment": "Elec. Distribution", "values": [240.0, 240.0, 240.0, 240.0, 240.0], "total": 1200.0}, {"segment": "Generation (renewables)", "values": [200.0, 350.0, 300.0, 150.0, 50.0], "total": 1050.0}, {"segment": "Generation (conventional)", "values": [250.0, 250.0, 250.0, 250.0, 250.0], "total": 1250.0}, {"segment": "Corp./Other", "values": [90.0, 90.0, 90.0, 90.0, 90.0], "total": 450.0}]}, {"name": "MDU Resources", "ticker": "MDU", "historical": [909400000.0, 972102000.0, 625375000.0, 388183000.0, 341382000.0, 568230000.0, 576065000.0, 558007000.0, 485197000.0, 442582000.0, 484136000.0, 522824000.0], "forecast": [539.0, 811.0, 593.0, 562.0, 562.0], "segments": [{"segment": "Electric", "values": [157.0, 494.0, 205.0, 162.5, 162.5], "total": 1181.0}, {"segment": "Gas Distribution", "values": [312.0, 258.0, 293.0, 274.5, 274.5], "total": 1412.0}, {"segment": "Gas Transmission", "values": [70.0, 59.0, 95.0, 125.0, 125.0], "total": 474.0}]}, {"name": "MGE Energy Inc.", "ticker": "MGEE", "historical": [NaN, 92676000.0, 72030000.0, 83659000.0, 108131000.0, 212197000.0, 164036000.0, 203139000.0, 153169000.0, 175030000.0, 222071000.0, 236925000.0], "forecast": [240.0, 265.0, 285.0, 296.0, 312.0], "segments": [{"segment": "Elec. Distribution", "values": [64.0, 70.0, 76.0, 78.0, 83.0], "total": 371.0}, {"segment": "Elec. Transmission", "values": [16.0, 18.0, 19.0, 20.0, 21.0], "total": 94.0}, {"segment": "Gas Distribution", "values": [28.0, 31.0, 33.0, 35.0, 36.0], "total": 163.0}, {"segment": "Generation (renewables)", "values": [132.0, 146.0, 157.0, 163.0, 172.0], "total": 770.0}, {"segment": "Generation (conventional)", "values": [0.0, 0.0, 0.0, 0.0, 0.0], "total": 0.0}, {"segment": "Corp./Other", "values": [0.0, 0.0, 0.0, 0.0, 0.0], "total": 0.0}]}, {"name": "NW Natural", "ticker": "NWN", "historical": [138924000.0, 120092000.0, 118320000.0, 139511000.0, 213325000.0, 214636000.0, 242283000.0, 280894000.0, 293892000.0, 338602000.0, 327347000.0, 394400000.0], "forecast": [476.0, 495.0, 515.0, 540.0, 560.0], "segments": [{"segment": "Elec. Distribution", "values": [0.0, 0.0, 0.0, 0.0, 0.0], "total": 0.0}, {"segment": "Elec. Transmission", "values": [0.0, 0.0, 0.0, 0.0, 0.0], "total": 0.0}, {"segment": "Gas Distribution", "values": [413.0, 430.0, 450.0, 470.0, 490.0], "total": 2253.0}, {"segment": "Generation (renewables)", "values": [0.0, 0.0, 0.0, 0.0, 0.0], "total": 0.0}, {"segment": "Generation (conventional)", "values": [0.0, 0.0, 0.0, 0.0, 0.0], "total": 0.0}, {"segment": "Corp./Other", "values": [63.0, 65.0, 65.0, 70.0, 70.0], "total": 333.0}]}, {"name": "National Fuel Gas", "ticker": "NFG", "historical": [703461000.0, 914417000.0, 1018179000.0, 581576000.0, 450335000.0, 584004000.0, 788938000.0, 1222411000.0, 751734000.0, 811826000.0, 1009868000.0, 931236000.0], "forecast": [923.0, 523.0, NaN, NaN, NaN], "segments": [{"segment": "Gas Utility", "values": [140.0, 212.0, NaN, NaN, NaN], "total": 352.0}, {"segment": "Gas Pipeline&Storage", "values": [175.0, 213.0, NaN, NaN, NaN], "total": 388.0}, {"segment": "Gas Gathering", "values": [505.0, NaN, NaN, NaN, NaN], "total": 505.0}, {"segment": "Gas E&P", "values": [103.0, 98.0, NaN, NaN, NaN], "total": 201.0}]}, {"name": "New Jersey Res.", "ticker": "NJR", "historical": [196208000.0, 288109000.0, 319877000.0, 354196000.0, 325649000.0, 377944000.0, 498054000.0, 470168000.0, 624610000.0, 598428000.0, 540919000.0, 571319000.0], "forecast": [700.0, 745.0, NaN, NaN, NaN], "segments": [{"segment": "Gas", "values": [525.0, 560.0, NaN, NaN, NaN], "total": 1085.0}, {"segment": "Generation (renewables)", "values": [175.0, 185.0, NaN, NaN, NaN], "total": 360.0}]}, {"name": "NextEra Energy", "ticker": "NEE", "historical": [3228000000.0, 3503000000.0, 3872000000.0, 4240000000.0, 5445000000.0, 6010000000.0, 11077000000.0, 7759000000.0, 7830000000.0, 9742000000.0, 9548000000.0, 8514000000.0], "forecast": [12900.0, 13800.0, 14700.0, 15600.0, 16500.0], "segments": [{"segment": "Elec. Distribution", "values": [3000.0, 3200.0, 3400.0, 3600.0, 3800.0], "total": 17000.0}, {"segment": "Elec. Transmission", "values": [1500.0, 1600.0, 1700.0, 1800.0, 1900.0], "total": 8500.0}, {"segment": "Generation (renewables)", "values": [7000.0, 7500.0, 8000.0, 8500.0, 9000.0], "total": 40000.0}, {"segment": "Generation (conventional)", "values": [800.0, 850.0, 900.0, 950.0, 1000.0], "total": 4500.0}, {"segment": "Corp./Other", "values": [600.0, 650.0, 700.0, 750.0, 800.0], "total": 3500.0}]}, {"name": "NiSource Inc.", "ticker": "NI", "historical": [1879900000.0, 2028500000.0, 1360700000.0, 1475200000.0, 1695800000.0, 1818200000.0, 1802400000.0, 1758100000.0, 1838000000.0, 2203100000.0, 2645800000.0, 2643000000.0], "forecast": [3661.0, 3661.0, 3661.0, 3661.0, 3661.0], "segments": [{"segment": "Elec. Distribution", "values": [641.0, 641.0, 641.0, 641.0, 641.0], "total": 3205.0}, {"segment": "Elec. Transmission", "values": [275.0, 275.0, 275.0, 275.0, 275.0], "total": 1375.0}, {"segment": "Gas Distribution", "values": [2379.0, 2379.0, 2379.0, 2379.0, 2379.0], "total": 11895.0}, {"segment": "Generation (renewables)", "values": [366.0, 366.0, 366.0, 366.0, 366.0], "total": 1830.0}, {"segment": "Generation (conventional)", "values": [0.0, 0.0, 0.0, 0.0, 0.0], "total": 0.0}, {"segment": "Corp./Other", "values": [0.0, 0.0, 0.0, 0.0, 0.0], "total": 0.0}]}, {"name": "NorthWestern Corp.", "ticker": "NWE", "historical": [230454000.0, 270384000.0, 283705000.0, 287901000.0, 276438000.0, 283966000.0, 316000000.0, 405762000.0, 434328000.0, 515140000.0, 566889000.0, 549244000.0], "forecast": [1500.0, 1500.0, 1500.0, 1500.0, 1500.0], "segments": [{"segment": "Elec. Distribution", "values": [300.0, 300.0, 300.0, 300.0, 300.0], "total": 1500.0}, {"segment": "Elec. Transmission", "values": [300.0, 300.0, 300.0, 300.0, 300.0], "total": 1500.0}, {"segment": "Gas Distribution", "values": [540.0, 540.0, 540.0, 540.0, 540.0], "total": 2700.0}, {"segment": "Generation (unspecified)", "values": [240.0, 240.0, 240.0, 240.0, 240.0], "total": 1200.0}, {"segment": "Corp./Other", "values": [120.0, 120.0, 120.0, 120.0, 120.0], "total": 600.0}]}, {"name": "OGE Energy Corp.", "ticker": "OGE", "historical": [990600000.0, 569300000.0, 547800000.0, 660100000.0, 824100000.0, 573600000.0, 635500000.0, 650500000.0, 778500000.0, 1050900000.0, 1178200000.0, 1090900000.0], "forecast": [1050.0, 1150.0, 1250.0, 1350.0, 1450.0], "segments": [{"segment": "Elec. Distribution", "values": [500.0, 550.0, 600.0, 650.0, 700.0], "total": 3000.0}, {"segment": "Elec. Transmission", "values": [300.0, 350.0, 400.0, 450.0, 500.0], "total": 2000.0}, {"segment": "Gas Distribution", "values": [0.0, 0.0, 0.0, 0.0, 0.0], "total": 0.0}, {"segment": "Generation (renewables)", "values": [50.0, 50.0, 50.0, 50.0, 50.0], "total": 250.0}, {"segment": "Generation (conventional)", "values": [150.0, 150.0, 150.0, 150.0, 150.0], "total": 750.0}, {"segment": "Corp./Other", "values": [50.0, 50.0, 50.0, 50.0, 50.0], "total": 250.0}]}, {"name": "ONE Gas Inc.", "ticker": "OGS", "historical": [292080000.0, 297103000.0, 294320000.0, 309071000.0, 356361000.0, 394450000.0, 417322000.0, 471345000.0, 502800000.0, 609486000.0, 666634000.0, 703165000.0], "forecast": [750.0, 813.0, 813.0, 812.0, 812.0], "segments": [{"segment": "Gas", "values": [750.0, 813.0, 813.0, 812.0, 812.0], "total": 4000.0}]}, {"name": "Otter Tail Corp.", "ticker": "OTTR", "historical": [164463000.0, 163582000.0, 160084000.0, 161259000.0, 132913000.0, 105425000.0, 207365000.0, 371553000.0, 171829000.0, 171134000.0, 287134000.0, 358650000.0], "forecast": [278.0, 335.0, 374.0, 382.0, 186.0], "segments": [{"segment": "Elec. T&D", "values": [96.0, 130.0, 198.0, 151.0, 134.0], "total": 709.0}, {"segment": "Generation (renewables)", "values": [101.0, 127.0, 118.0, 179.0, 4.0], "total": 529.0}, {"segment": "Corp./Other", "values": [81.0, 78.0, 58.0, 52.0, 48.0], "total": 317.0}]}, {"name": "PG&E Corp.", "ticker": "PCG", "historical": [5207000000.0, 4833000000.0, 5173000000.0, 5709000000.0, 5641000000.0, 6514000000.0, 6313000000.0, 7690000000.0, 7689000000.0, 9584000000.0, 9714000000.0, 10369000000.0], "forecast": [12000.0, 12500.0, 12500.0, 12500.0, 12500.0], "segments": [{"segment": "Elec. Distribution", "values": [7800.0, 8000.0, 8000.0, 8100.0, 8100.0], "total": 40000.0}, {"segment": "Elec. Transmission", "values": [2000.0, 2100.0, 2100.0, 2100.0, 1700.0], "total": 10000.0}, {"segment": "Gas", "values": [1800.0, 2000.0, 2000.0, 1900.0, 2300.0], "total": 10000.0}, {"segment": "Corp./Other", "values": [400.0, 400.0, 400.0, 400.0, 400.0], "total": 2000.0}]}, {"name": "PPL Corp.", "ticker": "PPL", "historical": [4307000000.0, 4185000000.0, 3532000000.0, 2957000000.0, 3171000000.0, 3238000000.0, 3083000000.0, 3249000000.0, 1973000000.0, 2155000000.0, 2390000000.0, 2805000000.0], "forecast": [3600.0, 3710.0, 3710.0, 3810.0, 3810.0], "segments": [{"segment": "Elec. Distribution", "values": [1730.0, 1800.0, 1830.0, 1830.0, 1830.0], "total": 9020.0}, {"segment": "Elec. Transmission", "values": [880.0, 920.0, 940.0, 940.0, 940.0], "total": 4620.0}, {"segment": "Gas Distribution", "values": [420.0, 450.0, 440.0, 440.0, 440.0], "total": 2190.0}, {"segment": "Generation (renewables)", "values": [490.0, 460.0, 430.0, 550.0, 550.0], "total": 2480.0}, {"segment": "Generation (conventional)", "values": [80.0, 80.0, 70.0, 50.0, 50.0], "total": 330.0}, {"segment": "Corp./Other", "values": [0.0, 0.0, 0.0, 0.0, 0.0], "total": 0.0}]}, {"name": "PSEG", "ticker": "PEG", "historical": [2811000000.0, 2921000000.0, 3969000000.0, 4298000000.0, 4307000000.0, 4058000000.0, 3264000000.0, 3034000000.0, 2719000000.0, 2888000000.0, 3325000000.0, 3380000000.0], "forecast": [3800.0, 4650.0, 4950.0, 5300.0, 5550.0], "segments": [{"segment": "Elec. Distribution", "values": [1000.0, 700.0, 900.0, 1100.0, 1000.0], "total": 4700.0}, {"segment": "Elec. Transmission", "values": [950.0, 1900.0, 2000.0, 2000.0, 1850.0], "total": 8700.0}, {"segment": "Generation (renewables)", "values": [500.0, 550.0, 600.0, 650.0, 500.0], "total": 2800.0}, {"segment": "Generation (conventional)", "values": [0.0, 0.0, 0.0, 0.0, 0.0], "total": 0.0}, {"segment": "Gas Distribution", "values": [1150.0, 1250.0, 1300.0, 1450.0, 1700.0], "total": 6850.0}, {"segment": "Corp./Other", "values": [200.0, 250.0, 150.0, 100.0, 500.0], "total": 1200.0}]}, {"name": "Pinnacle West", "ticker": "PNW", "historical": [1016322000.0, 910634000.0, 1076087000.0, 1275472000.0, 1408774000.0, 1178169000.0, 1191447000.0, 1326584000.0, 1473475000.0, 1707490000.0, 1846370000.0, 2249195000.0], "forecast": [2413.0, 2413.0, 2412.0, NaN, NaN], "segments": [{"segment": "Elec. T&D", "values": [1609.0, 1609.0, 1607.0, NaN, NaN], "total": 4825.0}, {"segment": "Generation (renewables)", "values": [402.0, 402.0, 403.0, NaN, NaN], "total": 1207.0}, {"segment": "Generation (conventional)", "values": [402.0, 402.0, 402.0, NaN, NaN], "total": 1206.0}]}, {"name": "Portland General", "ticker": "POR", "historical": [656000000.0, 1007000000.0, 598000000.0, 584000000.0, 514000000.0, 595000000.0, 606000000.0, 784000000.0, 636000000.0, 766000000.0, 1358000000.0, 1268000000.0], "forecast": [1215.0, 1150.0, 1280.0, 1340.0, 1435.0], "segments": [{"segment": "Generation", "values": [160.0, 165.0, 170.0, 175.0, 175.0], "total": 845.0}, {"segment": "Energy storage (battery)", "values": [165.0, NaN, NaN, NaN, NaN], "total": 165.0}, {"segment": "Elec. Transmission", "values": [200.0, 255.0, 390.0, 420.0, 515.0], "total": 1780.0}, {"segment": "Elec. Distribution", "values": [570.0, 610.0, 600.0, 625.0, 615.0], "total": 3020.0}, {"segment": "Corp./Other", "values": [120.0, 120.0, 120.0, 120.0, 130.0], "total": 610.0}]}, {"name": "Sempra Energy", "ticker": "SRE", "historical": [2572000000.0, 3123000000.0, 3156000000.0, 4214000000.0, 3705000000.0, 3784000000.0, 3708000000.0, 4676000000.0, 5015000000.0, 5357000000.0, 8397000000.0, 8215000000.0], "forecast": [9400.0, 9600.0, 9800.0, 9600.0, 9600.0], "segments": [{"segment": "Elec. T&D", "values": [4300.0, 4400.0, 4500.0, 4400.0, 4400.0], "total": 22000.0}, {"segment": "Gas", "values": [3100.0, 3200.0, 3300.0, 3200.0, 3200.0], "total": 16000.0}, {"segment": "Corp./Other", "values": [2000.0, 2000.0, 2000.0, 2000.0, 2000.0], "total": 10000.0}]}, {"name": "Southern Co.", "ticker": "SO", "historical": [5463000000.0, 5977000000.0, 7393000000.0, 7310000000.0, 7423000000.0, 8001000000.0, 7555000000.0, 7441000000.0, 7586000000.0, 7923000000.0, 9095000000.0, 8955000000.0], "forecast": [9500.0, 9600.0, 9700.0, 9600.0, 9600.0], "segments": [{"segment": "Elec. T&D", "values": [5600.0, 5700.0, 5800.0, 5600.0, 5300.0], "total": 28000.0}, {"segment": "Generation (renewables)", "values": [1500.0, 1500.0, 1500.0, 1500.0, 1500.0], "total": 7500.0}, {"segment": "Generation (conventional)", "values": [1500.0, 1500.0, 1500.0, 1500.0, 1500.0], "total": 7500.0}, {"segment": "Gas", "values": [900.0, 900.0, 900.0, 1000.0, 1300.0], "total": 5000.0}]}, {"name": "Southwest Gas", "ticker": "SWX", "historical": [364276000.0, 396898000.0, 488000000.0, 529531000.0, 623649000.0, 765914000.0, 938148000.0, 825105000.0, 715626000.0, 859421000.0, 872521000.0, 945923000.0], "forecast": [880.0, 855.0, 855.0, 855.0, 855.0], "segments": []}, {"name": "Spire Inc.", "ticker": "SR", "historical": [130788000.0, 171000000.0, 289800000.0, 293300000.0, 438100000.0, 499400000.0, 823300000.0, 638400000.0, 624800000.0, 552200000.0, 662500000.0, 861300000.0], "forecast": [840.0, 729.0, 729.0, 729.0, 729.0], "segments": []}, {"name": "TXNM Energy Inc.", "ticker": "TXNM", "historical": [NaN, NaN, NaN, NaN, NaN, NaN, 616273000.0, 679028000.0, 935016000.0, 912557000.0, 1075812000.0, 1247041000.0], "forecast": [1560.0, 1660.0, 1760.0, 1820.0, 1920.0], "segments": [{"segment": "Elec. Distribution", "values": [550.0, 600.0, 650.0, 700.0, 750.0], "total": 3250.0}, {"segment": "Elec. Transmission", "values": [450.0, 500.0, 550.0, 600.0, 650.0], "total": 2750.0}, {"segment": "Generation (renewables)", "values": [200.0, 250.0, 300.0, 300.0, 300.0], "total": 1350.0}, {"segment": "Generation (conventional)", "values": [100.0, 100.0, 100.0, 100.0, 100.0], "total": 500.0}, {"segment": "Corp./Other", "values": [260.0, 210.0, 160.0, 120.0, 120.0], "total": 870.0}]}, {"name": "UGI Corp.", "ticker": "UGI", "historical": [486000000.0, 456800000.0, 490600000.0, 563800000.0, 638900000.0, 574000000.0, 705000000.0, 655000000.0, 690000000.0, 804000000.0, 974000000.0, 796000000.0], "forecast": [900.0, 900.0, 900.0, NaN, NaN], "segments": [{"segment": "Gas distribution", "values": [630.0, 630.0, 630.0, NaN, NaN], "total": 1890.0}, {"segment": "Corp./Other", "values": [270.0, 270.0, 270.0, NaN, NaN], "total": 810.0}]}, {"name": "Unitil Corp.", "ticker": "UTL", "historical": [89500000.0, 92600000.0, 103900000.0, 98100000.0, 119300000.0, 102400000.0, 119200000.0, 122600000.0, 115000000.0, 122100000.0, 141000000.0, 169900000.0], "forecast": [170.0, 176.0, 190.0, 196.0, 221.0], "segments": []}, {"name": "WEC Energy Group", "ticker": "WEC", "historical": [687400000.0, 736100000.0, 1223900000.0, 1423700000.0, 1959500000.0, 2115700000.0, 2260800000.0, 2238800000.0, 2252800000.0, 2314900000.0, 2492900000.0, 2781100000.0], "forecast": [5300.0, 5600.0, 5850.0, 5800.0, 5500.0], "segments": [{"segment": "Elec. Distribution", "values": [1300.0, 1400.0, 1500.0, 1500.0, 1500.0], "total": 7200.0}, {"segment": "Elec. Transmission", "values": [600.0, 650.0, 650.0, 650.0, 700.0], "total": 3250.0}, {"segment": "Generation (renewables)", "values": [1700.0, 1800.0, 1900.0, 1900.0, 1800.0], "total": 9100.0}, {"segment": "Generation (conventional)", "values": [900.0, 900.0, 900.0, 800.0, 500.0], "total": 4000.0}, {"segment": "Corp./Other", "values": [200.0, 200.0, 200.0, 200.0, 200.0], "total": 1000.0}, {"segment": "Gas distribution", "values": [600.0, 650.0, 700.0, 750.0, 800.0], "total": 3500.0}]}, {"name": "Xcel Energy Inc.", "ticker": "XEL", "historical": [3395325000.0, 3199791000.0, 3683359000.0, 3255550000.0, 3319000000.0, 3957000000.0, 4225000000.0, 5369000000.0, 4244000000.0, 4638000000.0, 5854000000.0, 7364000000.0], "forecast": [11000.0, 9840.0, 8750.0, 7570.0, 7840.0], "segments": [{"segment": "Elec. Distribution", "values": [2570.0, 3000.0, 3400.0, 3320.0, 3540.0], "total": 15830.0}, {"segment": "Elec. Transmission", "values": [2260.0, 2860.0, 2740.0, 2390.0, 2310.0], "total": 12560.0}, {"segment": "Gas Distribution", "values": [800.0, 680.0, 690.0, 630.0, 620.0], "total": 3420.0}, {"segment": "Generation (renewables)", "values": [3360.0, 1400.0, 260.0, 0.0, 0.0], "total": 5020.0}, {"segment": "Generation (conventional)", "values": [1210.0, 1150.0, 910.0, 580.0, 620.0], "total": 4470.0}, {"segment": "Corp./Other", "values": [800.0, 750.0, 750.0, 650.0, 750.0], "total": 3700.0}]}], "historical_years": [2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "forecast_years": [2025, 2026, 2027, 2028, 2029], "historical_totals": [78089.708, 84183.59, 91598.333, 97878.787, 100166.167, 107118.277, 116985.74, 123059.083, 120998.666, 132558.246, 149694.454, 158617.843], "forecast_totals": [193214.0, 202859.0, 203031.0, 199691.0, 179171.0], "segments": [["Elec. Distribution", {"total": 257834.16380182002, "by_year": [51455.0, 52791.0, 53450.0, 54408.16380182002, 45730.0]}], ["Elec. Transmission", {"total": 163931.7856420627, "by_year": [30446.0, 33948.0, 34813.0, 34205.78564206269, 30519.0]}], ["Elec. T&D", {"total": 161661.0, "by_year": [30699.0, 33476.0, 34125.0, 32283.0, 31078.0]}], ["Generation (renewables)", {"total": 136036.93781597575, "by_year": [28024.5, 27556.0, 28212.0, 27353.937815975733, 24890.5]}], ["Gas Distribution", {"total": 88206.0, "by_year": [16720.0, 17572.0, 17981.0, 17973.5, 17959.5]}], ["Generation (conventional)", {"total": 71442.44742163802, "by_year": [15159.5, 16764.0, 15010.0, 14986.447421638019, 9522.5]}], ["Corp./Other", {"total": 41938.66531850354, "by_year": [8505.0, 8483.0, 8338.0, 8060.665318503539, 8552.0]}], ["Gas", {"total": 37205.0, "by_year": [7370.0, 7748.0, 7288.0, 7187.0, 7612.0]}], ["Gas distribution", {"total": 5390.0, "by_year": [1230.0, 1280.0, 1330.0, 750.0, 800.0]}], ["Generation (unspecified)", {"total": 1200.0, "by_year": [240.0, 240.0, 240.0, 240.0, 240.0]}], ["Electric", {"total": 1181.0, "by_year": [157.0, 494.0, 205.0, 162.5, 162.5]}], ["Generation", {"total": 845.0, "by_year": [160.0, 165.0, 170.0, 175.0, 175.0]}], ["Gas Gathering", {"total": 505.0, "by_year": [505.0, 0, 0, 0, 0]}], ["Gas Transmission", {"total": 474.0, "by_year": [70.0, 59.0, 95.0, 125.0, 125.0]}], ["Gas Pipeline&Storage", {"total": 388.0, "by_year": [175.0, 213.0, 0, 0, 0]}], ["Gas Utility", {"total": 352.0, "by_year": [140.0, 212.0, 0, 0, 0]}], ["Gas E&P", {"total": 201.0, "by_year": [103.0, 98.0, 0, 0, 0]}], ["Energy storage (battery)", {"total": 165.0, "by_year": [165.0, 0, 0, 0, 0]}]], "company_count": 47};
        
        // Helper function to format numbers with commas
        function formatWithCommas(num) {
            if (num === null || num === undefined || isNaN(num)) {
                return 'N/A';
            }
            return Math.round(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
        
        // Format currency
        function formatCurrency(val) {
            if (val === null || val === undefined || isNaN(val)) {
                return 'N/A';
            }
            if (val >= 1000) {
                return '$' + (val / 1000).toFixed(1) + 'B';
            }
            return '$' + Math.round(val) + 'M';
        }
        
        // Define segment order hierarchy
        const segmentOrder = [
            'Generation (renewables)',
            'Generation (conventional)',
            'Generation (unspecified)',
            'Generation',
            'Elec. Transmission',
            'Elec. Distribution',
            'Elec. T&D',
            'Electric',
            'Energy storage (battery)',
            'Gas Transmission',
            'Gas Distribution',
            'Gas distribution',
            'Gas Pipeline&Storage',
            'Gas Gathering',
            'Gas E&P',
            'Gas Utility',
            'Gas',
            'Corp./Other'
        ];
        
        // Initialize dashboard
        async function initDashboard() {
            try {
                // Initialize all components
                initializeMetrics();
                initializeCharts();
                initializeTables();
                
                // Set up tab switching
                setupTabSwitching();
                
            } catch (error) {
                console.error('Error initializing dashboard:', error);
            }
        }
        
        // Initialize metrics
        function initializeMetrics() {
            const metrics = document.getElementById('metricsContainer');
            
            // Calculate key metrics from actual data
            const hist2024 = dashboardData.historical_totals[11];
            const hist2014 = dashboardData.historical_totals[1]; // 2014 is index 1
            const fore2025 = dashboardData.forecast_totals[0];
            
            // Calculate 10-year CAGR (2014-2024)
            const cagr = hist2024 && hist2014 ? ((Math.pow(hist2024 / hist2014, 1/10) - 1) * 100) : null;
            
            // Calculate 5-year total
            const fiveYearTotal = dashboardData.forecast_totals.reduce((sum, val) => {
                return sum + (val || 0);
            }, 0);
            
            // Calculate YoY growth
            const yoyGrowth = hist2024 && fore2025 ? ((fore2025 - hist2024) / hist2024 * 100) : null;
            
            metrics.innerHTML = `
                <div class="metric-card">
                    <div class="metric-value">${formatCurrency(hist2024)}</div>
                    <div class="metric-label">2024 Actual</div>
                    <div class="metric-change">Last historical year</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${formatCurrency(fore2025)}</div>
                    <div class="metric-label">2025 Forecast</div>
                    <div class="metric-change ${yoyGrowth >= 0 ? 'positive' : 'negative'}">
                        ${yoyGrowth ? (yoyGrowth >= 0 ? 'â†‘' : 'â†“') + ' ' + Math.abs(yoyGrowth).toFixed(1) + '% YoY' : 'N/A'}
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${cagr ? cagr.toFixed(1) + '%' : 'N/A'}</div>
                    <div class="metric-label">10-Year CAGR</div>
                    <div class="metric-change">2014-2024</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${formatCurrency(fiveYearTotal)}</div>
                    <div class="metric-label">5-Year Total</div>
                    <div class="metric-change">2025-2029</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${hist2024 && hist2014 ? (hist2024 / hist2014).toFixed(1) + 'x' : 'N/A'}</div>
                    <div class="metric-label">Growth Multiple</div>
                    <div class="metric-change">2024 vs 2014</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${dashboardData.company_count}</div>
                    <div class="metric-label">Companies</div>
                    <div class="metric-change">U.S. Only</div>
                </div>
            `;
        }
        
        // Initialize charts
        function initializeCharts() {
            // Chart defaults
            Chart.defaults.color = '#94a3b8';
            Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';
            Chart.defaults.font.family = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            
            // 1. Timeline Chart - Fixed version
            const ctx1 = document.getElementById('timelineChart');
            if (ctx1) {
                // Use years starting from 2014
                const displayYears = [...dashboardData.historical_years.slice(1), ...dashboardData.forecast_years];
                const displayValues = [...dashboardData.historical_totals.slice(1), ...dashboardData.forecast_totals];
                
                new Chart(ctx1, {
                    type: 'bar',
                    data: {
                        labels: displayYears,
                        datasets: [
                            {
                                label: 'Historical Capex',
                                data: displayYears.map((year, idx) => {
                                    if (year <= 2024) {
                                        return displayValues[idx] || null;
                                    }
                                    return null;
                                }),
                                backgroundColor: 'rgba(96, 165, 250, 0.7)',
                                borderColor: 'rgba(96, 165, 250, 1)',
                                borderWidth: 2,
                                borderRadius: 4
                            },
                            {
                                label: 'Forecast Capex',
                                data: displayYears.map((year, idx) => {
                                    if (year >= 2025) {
                                        return displayValues[idx] || null;
                                    }
                                    return null;
                                }),
                                backgroundColor: 'rgba(167, 139, 250, 0.7)',
                                borderColor: 'rgba(167, 139, 250, 1)',
                                borderWidth: 2,
                                borderRadius: 4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: { 
                                    padding: 15,
                                    font: { size: 12 }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    title: (context) => `Year ${context[0].label}`,
                                    label: (context) => {
                                        if (context.parsed.y === null) return null;
                                        const value = context.parsed.y;
                                        const label = context.datasetIndex === 0 ? 'Historical' : 'Forecast';
                                        return `${label}: $${(value / 1000).toFixed(1)}B`;
                                    },
                                    footer: (tooltipItems) => {
                                        const yearIdx = tooltipItems[0].dataIndex;
                                        if (yearIdx > 0) {
                                            const currentVal = displayValues[yearIdx];
                                            const prevVal = displayValues[yearIdx - 1];
                                            if (currentVal && prevVal) {
                                                const growth = ((currentVal - prevVal) / prevVal * 100).toFixed(1);
                                                return `YoY Growth: ${growth >= 0 ? '+' : ''}${growth}%`;
                                            }
                                        }
                                        return '';
                                    }
                                },
                                filter: (tooltipItem) => tooltipItem.parsed.y !== null
                            },
                            annotation: {
                                annotations: {
                                    line1: {
                                        type: 'line',
                                        xMin: 10.5,
                                        xMax: 10.5,
                                        borderColor: 'rgba(255, 255, 255, 0.3)',
                                        borderWidth: 2,
                                        borderDash: [6, 6],
                                        label: {
                                            content: 'Forecast â†’',
                                            enabled: true,
                                            position: 'end',
                                            backgroundColor: 'rgba(167, 139, 250, 0.8)',
                                            color: 'white',
                                            font: { size: 11 }
                                        }
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Annual Capex ($ Millions)',
                                    font: { size: 12 }
                                },
                                ticks: {
                                    callback: (value) => {
                                        if (value >= 1000) {
                                            return `$${(value / 1000).toFixed(0)}B`;
                                        }
                                        return `$${value}M`;
                                    },
                                    font: { size: 11 }
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Year',
                                    font: { size: 12 }
                                },
                                ticks: {
                                    maxRotation: 45,
                                    minRotation: 45,
                                    font: { size: 11 }
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                }
                            }
                        }
                    }
                });
            }
            
            // Continue with other charts...
            initializeAdditionalCharts();
        }
        
        function initializeAdditionalCharts() {
            // 2. Top Companies Chart
            const ctx2 = document.getElementById('topCompaniesChart');
            if (ctx2) {
                // Calculate 5-year totals for each company
                const companyTotals = dashboardData.companies.map(company => {
                    const total = company.forecast.reduce((sum, val) => sum + (val || 0), 0);
                    return { name: company.name, ticker: company.ticker, total: total };
                });
                
                // Sort and get top 10
                companyTotals.sort((a, b) => b.total - a.total);
                const top10 = companyTotals.slice(0, 10);
                
                new Chart(ctx2, {
                    type: 'bar',
                    data: {
                        labels: top10.map(c => c.name.replace(' Corp.', '').replace(' Inc.', '')),
                        datasets: [{
                            label: '5-Year Total ($B)',
                            data: top10.map(c => c.total / 1000),
                            backgroundColor: 'rgba(167, 139, 250, 0.7)',
                            borderColor: 'rgba(167, 139, 250, 1)',
                            borderWidth: 2,
                            borderRadius: 8
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: (context) => `Total: $${context.parsed.x.toFixed(1)}B`
                                }
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    callback: (value) => `$${value}B`
                                }
                            }
                        }
                    }
                });
            }
            
            // 3. Segment Chart
            const ctx3 = document.getElementById('segmentChart');
            if (ctx3) {
                const segmentData = dashboardData.segments.slice(0, 8); // Top 8 segments
                
                new Chart(ctx3, {
                    type: 'doughnut',
                    data: {
                        labels: segmentData.map(s => s[0]),
                        datasets: [{
                            data: segmentData.map(s => s[1].total / 1000),
                            backgroundColor: [
                                'rgba(96, 165, 250, 0.8)',
                                'rgba(167, 139, 250, 0.8)',
                                'rgba(251, 191, 36, 0.8)',
                                'rgba(74, 222, 128, 0.8)',
                                'rgba(251, 146, 60, 0.8)',
                                'rgba(244, 114, 182, 0.8)',
                                'rgba(148, 163, 184, 0.8)',
                                'rgba(248, 113, 113, 0.8)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { padding: 10 }
                            },
                            tooltip: {
                                callbacks: {
                                    label: (context) => {
                                        const value = context.parsed;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${context.label}: $${value.toFixed(1)}B (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // 4. Generation Chart
            const ctx4 = document.getElementById('generationChart');
            if (ctx4) {
                const renewableData = dashboardData.segments.find(s => s[0] === 'Generation (renewables)');
                const conventionalData = dashboardData.segments.find(s => s[0] === 'Generation (conventional)');
                
                new Chart(ctx4, {
                    type: 'bar',
                    data: {
                        labels: dashboardData.forecast_years,
                        datasets: [
                            {
                                label: 'Renewable Generation',
                                data: renewableData ? renewableData[1].by_year.map(v => v / 1000) : [],
                                backgroundColor: 'rgba(74, 222, 128, 0.7)',
                                borderColor: 'rgba(74, 222, 128, 1)',
                                borderWidth: 2
                            },
                            {
                                label: 'Conventional Generation',
                                data: conventionalData ? conventionalData[1].by_year.map(v => v / 1000) : [],
                                backgroundColor: 'rgba(251, 146, 60, 0.7)',
                                borderColor: 'rgba(251, 146, 60, 1)',
                                borderWidth: 2
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'top' },
                            tooltip: {
                                callbacks: {
                                    label: (context) => `${context.dataset.label}: $${context.parsed.y.toFixed(1)}B`
                                }
                            }
                        },
                        scales: {
                            y: {
                                title: {
                                    display: true,
                                    text: 'Annual Investment ($B)'
                                },
                                ticks: {
                                    callback: (value) => `$${value}B`
                                }
                            }
                        }
                    }
                });
            }
            
            // 5. Growth Chart
            const ctx5 = document.getElementById('growthChart');
            if (ctx5) {
                const allYears = [...dashboardData.historical_years.slice(1), ...dashboardData.forecast_years];
                const allValues = [...dashboardData.historical_totals.slice(1), ...dashboardData.forecast_totals];
                
                const growthData = [];
                for (let i = 1; i < allValues.length; i++) {
                    if (allValues[i] !== null && allValues[i-1] !== null && allValues[i-1] > 0) {
                        growthData.push(((allValues[i] - allValues[i-1]) / allValues[i-1] * 100));
                    } else {
                        growthData.push(null);
                    }
                }
                
                new Chart(ctx5, {
                    type: 'bar',
                    data: {
                        labels: allYears.slice(1),
                        datasets: [{
                            label: 'YoY Growth (%)',
                            data: growthData,
                            backgroundColor: allYears.slice(1).map(y => 
                                y < 2025 ? 'rgba(96, 165, 250, 0.7)' : 'rgba(167, 139, 250, 0.7)'
                            ),
                            borderColor: allYears.slice(1).map(y => 
                                y < 2025 ? 'rgba(96, 165, 250, 1)' : 'rgba(167, 139, 250, 1)'
                            ),
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: (context) => {
                                        if (context.parsed.y === null) return 'No data';
                                        return `Growth: ${context.parsed.y.toFixed(1)}%`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                title: {
                                    display: true,
                                    text: 'Year-over-Year Growth (%)'
                                },
                                ticks: {
                                    callback: (value) => value !== null ? `${value.toFixed(0)}%` : ''
                                }
                            }
                        }
                    }
                });
            }
            
            // 6. Segment Trend Chart
            const ctx6 = document.getElementById('segmentTrendChart');
            if (ctx6) {
                const topSegments = dashboardData.segments.slice(0, 6);
                
                new Chart(ctx6, {
                    type: 'line',
                    data: {
                        labels: dashboardData.forecast_years,
                        datasets: topSegments.map((seg, idx) => ({
                            label: seg[0],
                            data: seg[1].by_year.map(v => v / 1000),
                            borderColor: [
                                'rgba(96, 165, 250, 1)',
                                'rgba(167, 139, 250, 1)',
                                'rgba(251, 191, 36, 1)',
                                'rgba(74, 222, 128, 1)',
                                'rgba(251, 146, 60, 1)',
                                'rgba(244, 114, 182, 1)'
                            ][idx],
                            backgroundColor: [
                                'rgba(96, 165, 250, 0.1)',
                                'rgba(167, 139, 250, 0.1)',
                                'rgba(251, 191, 36, 0.1)',
                                'rgba(74, 222, 128, 0.1)',
                                'rgba(251, 146, 60, 0.1)',
                                'rgba(244, 114, 182, 0.1)'
                            ][idx],
                            borderWidth: 3,
                            tension: 0.4
                        }))
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { padding: 10 }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    label: (context) => `${context.dataset.label}: $${context.parsed.y.toFixed(1)}B`
                                }
                            }
                        },
                        scales: {
                            y: {
                                title: {
                                    display: true,
                                    text: 'Annual Investment ($B)'
                                },
                                ticks: {
                                    callback: (value) => `$${value}B`
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Initialize tables
        function initializeTables() {
            populateCompanyTable();
        }
        
        // Populate company summary table with updates
        let currentPage = 1;
        const rowsPerPage = 15;
        let sortColumn = -1;
        let sortDirection = 1;
        
        function populateCompanyTable() {
            const tbody = document.getElementById('companyTableBody');
            const searchTerm = (document.getElementById('companySearch')?.value || '').toLowerCase();
            
            let filteredData = dashboardData.companies.filter(company => 
                company.name.toLowerCase().includes(searchTerm) || 
                company.ticker.toLowerCase().includes(searchTerm)
            );
            
            const processedData = filteredData.map(company => {
                const hist2014 = company.historical[1]; // 2014 is index 1
                const hist2024 = company.historical[11];
                
                // Check if company has full 5 years of forecast (not null, undefined, or NaN)
                const forecastCount = company.forecast.filter(val => 
                    val !== null && val !== undefined && !isNaN(val)
                ).length;
                const hasFullForecast = forecastCount === 5;
                
                // Calculate total from valid values only
                const totalSum = company.forecast.reduce((sum, val) => {
                    if (val !== null && val !== undefined && !isNaN(val)) {
                        return sum + val;
                    }
                    return sum;
                }, 0);
                
                // Show N/A for 5-yr total if not full 5 years
                const forecast5yr = hasFullForecast ? totalSum : null;
                
                // Calculate average based on available years
                const forecastAvg = forecastCount > 0 ? totalSum / forecastCount : null;
                
                const cagr10yr = hist2014 && hist2024 ? 
                    ((Math.pow(hist2024 / hist2014, 1/10) - 1) * 100) : null;
                
                // Calculate 2024-2029 CAGR only if we have full forecast
                let forecast5yrCagr = null;
                if (hist2024 && hasFullForecast && company.forecast[4] && !isNaN(company.forecast[4])) {
                    forecast5yrCagr = ((Math.pow(company.forecast[4] / (hist2024 / 1e6), 1/5) - 1) * 100);
                }
                
                return {
                    name: company.name,
                    ticker: company.ticker,
                    hist2014,
                    hist2024,
                    cagr10yr,
                    forecast5yr,
                    forecastAvg,
                    forecast5yrCagr
                };
            });
            
            if (sortColumn >= 0) {
                processedData.sort((a, b) => {
                    let aVal, bVal;
                    switch(sortColumn) {
                        case 0: aVal = a.name; bVal = b.name; break;
                        case 1: aVal = a.ticker; bVal = b.ticker; break;
                        case 2: aVal = a.hist2014 || 0; bVal = b.hist2014 || 0; break;
                        case 3: aVal = a.hist2024 || 0; bVal = b.hist2024 || 0; break;
                        case 4: aVal = a.cagr10yr || 0; bVal = b.cagr10yr || 0; break;
                        case 5: aVal = a.forecast5yr || 0; bVal = b.forecast5yr || 0; break;
                        case 6: aVal = a.forecastAvg || 0; bVal = b.forecastAvg || 0; break;
                        case 7: aVal = a.forecast5yrCagr || 0; bVal = b.forecast5yrCagr || 0; break;
                    }
                    if (typeof aVal === 'string') {
                        return sortDirection * aVal.localeCompare(bVal);
                    }
                    return sortDirection * (aVal - bVal);
                });
            }
            
            const startIdx = (currentPage - 1) * rowsPerPage;
            const endIdx = startIdx + rowsPerPage;
            const pageData = processedData.slice(startIdx, endIdx);
            
            tbody.innerHTML = pageData.map(company => `
                <tr>
                    <td class="company-name-cell">${company.name}</td>
                    <td>${company.ticker}</td>
                    <td class="number-cell ${company.hist2014 ? '' : 'na-cell'}">
                        ${company.hist2014 ? formatWithCommas(company.hist2014 / 1e6) : 'N/A'}
                    </td>
                    <td class="number-cell ${company.hist2024 ? '' : 'na-cell'}">
                        ${company.hist2024 ? formatWithCommas(company.hist2024 / 1e6) : 'N/A'}
                    </td>
                    <td class="number-cell change-cell ${company.cagr10yr !== null ? (company.cagr10yr >= 0 ? 'positive' : 'negative') : 'na-cell'}">
                        ${company.cagr10yr !== null ? ((company.cagr10yr >= 0 ? '+' : '') + company.cagr10yr.toFixed(1) + '%') : 'N/A'}
                    </td>
                    <td class="number-cell ${company.forecast5yr !== null ? '' : 'na-cell'}">
                        ${company.forecast5yr !== null ? formatWithCommas(company.forecast5yr) : 'N/A'}
                    </td>
                    <td class="number-cell ${company.forecastAvg !== null ? '' : 'na-cell'}">
                        ${company.forecastAvg !== null ? formatWithCommas(company.forecastAvg) : 'N/A'}
                    </td>
                    <td class="number-cell change-cell ${company.forecast5yrCagr !== null ? (company.forecast5yrCagr >= 0 ? 'positive' : 'negative') : 'na-cell'}">
                        ${company.forecast5yrCagr !== null ? ((company.forecast5yrCagr >= 0 ? '+' : '') + company.forecast5yrCagr.toFixed(1) + '%') : 'N/A'}
                    </td>
                </tr>
            `).join('');
            
            // Update pagination
            const totalPages = Math.ceil(processedData.length / rowsPerPage);
            const pagination = document.getElementById('pagination');
            
            pagination.innerHTML = `
                <button class="page-btn" onclick="changePage(-1)" ${currentPage === 1 ? 'disabled' : ''}>â†</button>
                <span class="page-info">Page ${currentPage} of ${totalPages} (${processedData.length} companies)</span>
                <button class="page-btn" onclick="changePage(1)" ${currentPage === totalPages ? 'disabled' : ''}>â†’</button>
            `;
        }
        
        // Other table population functions with formatting updates
        function populateHistoricalTable() {
            const tbody = document.getElementById('historicalTableBody');
            
            tbody.innerHTML = dashboardData.companies.map(company => {
                // Skip 2013, start from 2014 (index 1)
                const historicalFrom2014 = company.historical.slice(1);
                const total = historicalFrom2014.reduce((sum, val) => sum + (val || 0), 0);
                
                const hist2014 = company.historical[1];
                const hist2024 = company.historical[11];
                const cagr = hist2014 && hist2024 ? 
                    ((Math.pow(hist2024 / hist2014, 1/10) - 1) * 100) : null;
                
                return `
                    <tr>
                        <td class="company-name-cell sticky-column">${company.name}</td>
                        <td>${company.ticker}</td>
                        ${historicalFrom2014.map(val => 
                            `<td class="number-cell ${val ? '' : 'na-cell'}">
                                ${val ? formatWithCommas(val / 1e6) : 'N/A'}
                            </td>`
                        ).join('')}
                        <td class="number-cell"><strong>${formatWithCommas(total / 1e6)}</strong></td>
                        <td class="number-cell change-cell ${cagr !== null ? (cagr >= 0 ? 'positive' : 'negative') : 'na-cell'}">
                            ${cagr !== null ? cagr.toFixed(1) + '%' : 'N/A'}
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function populateForecastTable() {
            const tbody = document.getElementById('forecastTableBody');
            
            tbody.innerHTML = dashboardData.companies.map(company => {
                // Count valid values (not null, undefined, or NaN)
                const validCount = company.forecast.filter(v => 
                    v !== null && v !== undefined && !isNaN(v)
                ).length;
                const hasFullFiveYears = validCount === 5;
                
                // Calculate total only from valid values
                const total = company.forecast.reduce((sum, val) => {
                    if (val !== null && val !== undefined && !isNaN(val)) {
                        return sum + val;
                    }
                    return sum;
                }, 0);
                
                // Show N/A for 5-yr total if not full 5 years
                const fiveYearTotal = hasFullFiveYears ? total : null;
                
                // Calculate average based on actual years available
                const avg = validCount > 0 ? total / validCount : null;
                
                return `
                    <tr>
                        <td class="company-name-cell sticky-column">${company.name}</td>
                        <td>${company.ticker}</td>
                        ${company.forecast.map(val => 
                            `<td class="number-cell ${(val !== null && val !== undefined && !isNaN(val)) ? '' : 'na-cell'}">
                                ${(val !== null && val !== undefined && !isNaN(val)) ? formatWithCommas(val) : 'N/A'}
                            </td>`
                        ).join('')}
                        <td class="number-cell ${fiveYearTotal !== null ? '' : 'na-cell'}">
                            <strong>${fiveYearTotal !== null ? formatWithCommas(fiveYearTotal) : 'N/A'}</strong>
                        </td>
                        <td class="number-cell ${avg !== null ? '' : 'na-cell'}">
                            ${avg !== null ? formatWithCommas(avg) : 'N/A'}
                        </td>
                        <td class="number-cell">${validCount}</td>
                    </tr>
                `;
            }).join('');
        }
        
        function populateCompleteTable() {
            const tbody = document.getElementById('completeTableBody');
            
            tbody.innerHTML = dashboardData.companies.map(company => {
                // Skip 2013, start from 2014
                const historicalFrom2014 = company.historical.slice(1);
                
                return `
                    <tr>
                        <td class="company-name-cell sticky-column">${company.name}</td>
                        <td>${company.ticker}</td>
                        ${historicalFrom2014.map(val => 
                            `<td class="number-cell ${val ? '' : 'na-cell'}">
                                ${val ? formatWithCommas(val / 1e6) : 'N/A'}
                            </td>`
                        ).join('')}
                        ${company.forecast.map(val => 
                            `<td class="number-cell ${(val !== null && val !== undefined && !isNaN(val)) ? '' : 'na-cell'}" style="background: rgba(167, 139, 250, 0.05);">
                                ${(val !== null && val !== undefined && !isNaN(val)) ? formatWithCommas(val) : 'N/A'}
                            </td>`
                        ).join('')}
                    </tr>
                `;
            }).join('');
        }
        
        function populateSegmentTable() {
            const tbody = document.getElementById('segmentTableBody');
            
            let html = '';
            dashboardData.companies.forEach(company => {
                if (!company.segments || company.segments.length === 0) return;
                
                const companyTotal = company.forecast.reduce((sum, val) => sum + (val || 0), 0);
                
                // Sort segments by defined order
                const sortedSegments = [...company.segments].sort((a, b) => {
                    const aIndex = segmentOrder.indexOf(a.segment);
                    const bIndex = segmentOrder.indexOf(b.segment);
                    return (aIndex === -1 ? 999 : aIndex) - (bIndex === -1 ? 999 : bIndex);
                });
                
                sortedSegments.forEach((segment, idx) => {
                    const percentage = companyTotal > 0 && segment.total ? 
                        ((segment.total / companyTotal) * 100).toFixed(1) : 'N/A';
                    html += `
                        <tr>
                            <td class="company-name-cell sticky-column">${idx === 0 ? company.name : ''}</td>
                            <td>${idx === 0 ? company.ticker : ''}</td>
                            <td>${segment.segment}</td>
                            <td class="number-cell">${segment.total ? formatWithCommas(segment.total) : 'N/A'}</td>
                            ${segment.values.map(val => 
                                `<td class="number-cell ${val !== null && val !== undefined ? '' : 'na-cell'}">
                                    ${val !== null && val !== undefined ? formatWithCommas(val) : 'N/A'}
                                </td>`
                            ).join('')}
                            <td class="number-cell">${percentage}%</td>
                        </tr>
                    `;
                });
            });
            
            tbody.innerHTML = html;
        }
        
        // Filter functions
        function filterCompanyTable() {
            currentPage = 1;
            populateCompanyTable();
        }
        
        function filterHistoricalTable() {
            const searchTerm = document.getElementById('historicalSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#historicalTableBody tr');
            
            rows.forEach(row => {
                const companyName = row.cells[0].textContent.toLowerCase();
                const ticker = row.cells[1].textContent.toLowerCase();
                row.style.display = (companyName.includes(searchTerm) || ticker.includes(searchTerm)) ? '' : 'none';
            });
        }
        
        function filterForecastTable() {
            const searchTerm = document.getElementById('forecastSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#forecastTableBody tr');
            
            rows.forEach(row => {
                const companyName = row.cells[0].textContent.toLowerCase();
                const ticker = row.cells[1].textContent.toLowerCase();
                row.style.display = (companyName.includes(searchTerm) || ticker.includes(searchTerm)) ? '' : 'none';
            });
        }
        
        function filterCompleteTable() {
            const searchTerm = document.getElementById('completeSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#completeTableBody tr');
            
            rows.forEach(row => {
                const companyName = row.cells[0].textContent.toLowerCase();
                const ticker = row.cells[1].textContent.toLowerCase();
                row.style.display = (companyName.includes(searchTerm) || ticker.includes(searchTerm)) ? '' : 'none';
            });
        }
        
        function filterSegmentTable() {
            const searchTerm = document.getElementById('segmentSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#segmentTableBody tr');
            
            rows.forEach(row => {
                const companyName = row.cells[0].textContent.toLowerCase();
                const ticker = row.cells[1].textContent.toLowerCase();
                const segment = row.cells[2].textContent.toLowerCase();
                row.style.display = (companyName.includes(searchTerm) || 
                                    ticker.includes(searchTerm) || 
                                    segment.includes(searchTerm)) ? '' : 'none';
            });
        }
        
        // Sort and pagination functions
        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection *= -1;
            } else {
                sortColumn = column;
                sortDirection = 1;
            }
            populateCompanyTable();
        }
        
        function changePage(direction) {
            currentPage += direction;
            populateCompanyTable();
        }
        
        // Export functions with proper formatting
        function exportToCSV(type) {
            let csv = '';
            let filename = '';
            
            switch(type) {
                case 'summary':
                    csv = 'Company,Ticker,2014 ($M),2024 ($M),10-Yr CAGR %,5-Yr Forecast ($M),Avg Annual ($M),2024-2029 CAGR %\n';
                    dashboardData.companies.forEach(company => {
                        const hist2014 = company.historical[1];
                        const hist2024 = company.historical[11];
                        const hasFullForecast = company.forecast.every(val => val !== null && val !== undefined);
                        const forecast5yr = hasFullForecast ? 
                            company.forecast.reduce((sum, val) => sum + (val || 0), 0) : null;
                        const forecastAvg = forecast5yr !== null ? forecast5yr / 5 : null;
                        const cagr10yr = hist2014 && hist2024 ? 
                            ((Math.pow(hist2024 / hist2014, 1/10) - 1) * 100) : null;
                        let forecast5yrCagr = null;
                        if (hist2024 && hasFullForecast && company.forecast[4]) {
                            forecast5yrCagr = ((Math.pow(company.forecast[4] / (hist2024 / 1e6), 1/5) - 1) * 100);
                        }
                        
                        csv += `"${company.name}",${company.ticker},`;
                        csv += `${hist2014 ? Math.round(hist2014 / 1e6) : 'N/A'},`;
                        csv += `${hist2024 ? Math.round(hist2024 / 1e6) : 'N/A'},`;
                        csv += `${cagr10yr !== null ? cagr10yr.toFixed(1) : 'N/A'},`;
                        csv += `${forecast5yr !== null ? Math.round(forecast5yr) : 'N/A'},`;
                        csv += `${forecastAvg !== null ? Math.round(forecastAvg) : 'N/A'},`;
                        csv += `${forecast5yrCagr !== null ? forecast5yrCagr.toFixed(1) : 'N/A'}\n`;
                    });
                    filename = 'utility_capex_summary_47_companies.csv';
                    break;
                    
                // Add other export cases...
            }
            
            // Create and download the file
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
        
        // Tab switching
        function setupTabSwitching() {
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabPanels = document.querySelectorAll('.tab-panel');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Update buttons
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update panels
                    tabPanels.forEach(panel => panel.classList.remove('active'));
                    document.getElementById(targetTab).classList.add('active');
                    
                    // Initialize content if needed
                    initializeTabContent(targetTab);
                });
            });
        }
        
        function initializeTabContent(tabName) {
            switch(tabName) {
                case 'historical':
                    if (!document.getElementById('historicalTableBody').innerHTML) {
                        populateHistoricalTable();
                    }
                    break;
                case 'forecast':
                    if (!document.getElementById('forecastTableBody').innerHTML) {
                        populateForecastTable();
                    }
                    break;
                case 'complete':
                    if (!document.getElementById('completeTableBody').innerHTML) {
                        populateCompleteTable();
                    }
                    break;
                case 'segments':
                    if (!document.getElementById('segmentTableBody').innerHTML) {
                        populateSegmentTable();
                    }
                    break;
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>
